{% extends "base.html" %}

{% block title %}Podcast Transcriber - Home{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">
                    <i class="fas fa-rss"></i> Enter Podcast RSS Feed
                </h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('parse_rss') }}">
                    <div class="mb-3">
                        <label for="rss_url" class="form-label">RSS Feed URL</label>
                        <input type="url" class="form-control" id="rss_url" name="rss_url" 
                               placeholder="https://example.com/podcast/feed.xml" required>
                        <div class="form-text">
                            Enter the RSS feed URL of the podcast you want to transcribe.
                            <a href="/rss-help" class="text-primary ms-2">
                                <i class="fas fa-question-circle"></i> Need help finding RSS URLs?
                            </a>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Get Episodes
                    </button>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle"></i> How it works
                </h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Enter the RSS feed URL of your podcast</li>
                    <li>Select the episode you want to transcribe</li>
                    <li>Wait for the transcription to complete</li>
                    <li>Download the transcript and subtitle files</li>
                </ol>
                <p class="text-muted">
                    <strong>Note:</strong> The first run may take longer as the AI model needs to be downloaded (~3GB).
                </p>
            </div>
        </div>

        <!-- Apple Podcasts URL Converter -->
        <div class="card mt-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fab fa-apple me-2"></i> Got an Apple Podcasts URL? Convert it to RSS!
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">
                    If you found a podcast on Apple Podcasts, just paste the URL below and we'll convert it to an RSS feed for you!
                </p>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" id="appleUrlInput" class="form-control" 
                                   placeholder="https://podcasts.apple.com/us/podcast/..." 
                                   value="https://podcasts.apple.com/us/podcast/ness/id1766283329">
                            <button class="btn btn-primary" type="button" onclick="convertAppleUrl()">
                                <i class="fas fa-magic me-1"></i>Convert to RSS
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="conversionResult" style="display: none;"></div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Works with any Apple Podcasts URL. The converted RSS URL can be used directly in the form above!
                    </small>
                </div>
            </div>
        </div>

        <div class="card mt-4 border-info">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-lightbulb"></i> Need help finding other RSS URLs?
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">
                    For Spotify, Google Podcasts, or other platforms, you'll need to find the original RSS feed. 
                    Visit our comprehensive guide to learn how.
                </p>
                <div class="text-center">
                    <a href="/rss-help" class="btn btn-info">
                        <i class="fas fa-question-circle me-2"></i>
                        Complete RSS Guide
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function convertAppleUrl() {
    const input = document.getElementById('appleUrlInput');
    const resultDiv = document.getElementById('conversionResult');
    const url = input.value.trim();
    
    if (!url) {
        showResult('Please enter an Apple Podcasts URL', 'warning');
        return;
    }
    
    if (!url.includes('podcasts.apple.com')) {
        showResult('Please enter a valid Apple Podcasts URL', 'danger');
        return;
    }
    
    // Show loading
    showResult('Converting...', 'info', true);
    
    // Make API call
    fetch('/convert-apple-url', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ apple_url: url })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showResult(`
                <div class="alert alert-success p-2">
                    <h6><i class="fas fa-check-circle me-2"></i>Success!</h6>
                    <p class="mb-2 small">RSS Feed URL:</p>
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control form-control-sm" value="${data.rss_url}" readonly>
                        <button class="btn btn-outline-secondary btn-sm" type="button" onclick="copyToClipboard('${data.rss_url}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <small class="text-muted mt-1 d-block">Copy this RSS URL and paste it in the form above!</small>
                </div>
            `, 'success');
        } else {
            showResult(`<div class="alert alert-danger p-2"><i class="fas fa-exclamation-triangle me-2"></i>Error: ${data.error}</div>`, 'danger');
        }
    })
    .catch(error => {
        showResult(`<div class="alert alert-danger p-2"><i class="fas fa-exclamation-triangle me-2"></i>Error: ${error.message}</div>`, 'danger');
    });
}

function showResult(message, type, isLoading = false) {
    const resultDiv = document.getElementById('conversionResult');
    resultDiv.innerHTML = message;
    resultDiv.className = isLoading ? 'text-info' : '';
    resultDiv.style.display = 'block';
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // Show success message
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    });
}
</script>

{% endblock %}
